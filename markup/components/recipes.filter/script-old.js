!function(a){"use strict";a(function(){function b(){function b(){c()}function c(){function b(){function b(){for(var a=e.parent()[0].className.split(/\s*item\s*/),b=0;b<a.length;b++)if(""!=a[b]){a=a[b];break}return a}function c(a){switch(a){case"cuisine":return cuisineArray;case"dish":return dishTypeArray;case"ingredient":return mainIngredientArray;case"tag":return tagArray}return cuisineArray}function d(){if(e.hasClass("open"))return a("#filter_list").slideUp("middle").empty(),e.removeClass("open"),void(document.getElementById("filter_list").className="");var b="",c=Math.ceil(h[1].length/f);b+='<div class="pad"><table>';for(var d=0;c>d;d++){b+="<tr>";for(var i=0;f>i;i++){var j=c*i+d;b+=h[0][j]?'<td><a href="#" rel="'+h[0][j]+'">'+h[1][j]+"</a></td>":"<td><span></span></td>"}b+="</tr>"}b+="</table></div>",a("#filter_list").html(b).slideDown("middle"),a("#filter_recipes .item a").removeClass("open"),e.addClass("open"),document.getElementById("filter_list").className=g}var e=a(this),f=4,g=b(),h=c(g);return d(),!1}a("#filter_recipes").delegate(".b-filter__item","click",b)}b()}function c(){function b(){return document.getElementById("filter_list")?(c(),void d()):!1}function c(){function b(){function a(){for(var a,b=window.location.search,c=/([a-z0-9]+)=([a-z0-9]+)/gi,d={};null!=(a=c.exec(b));)d[a[1]]=a[2];return d}var b=a(),c={};for(var d in b)("cuisine"==d||"dish"==d||"ingredient"==d||"tag"==d)&&(c.type=d,c.data=b[d]);return c.num=b.num,c}function c(b){var c={};for(var d in b)c[d]=b[d];c.num||(c.num=a("#recipe_feed_block .b-recipe-thumb").length),c.allRecipesNum=parseInt(a("#fc_statistics span.num").text(),10),c.recipes=t();var e=window.History;e.enabled&&e.pushState(c)}function d(a){a.type&&a.data?g(a.type,a.data,a.num,!0):a.num&&h(a.num,!0)}var e=b();c(e),d(e)}function d(){a("#filter_list").click(function(a){a.stopPropagation()}).delegate("a","click",f),l(),a("#get_more_recipes a").click(j)}function f(){if(a("#filter_recipes").hasClass("i-link"))return!0;var b=document.getElementById("filter_list").className,c=this.getAttribute("rel");return g(b,c),a("#filter_list").hide().empty(),!1}function g(b,c,d,f){function g(){i()}function h(a){e=a.id;var d=parseInt(e.length,10)+parseInt(a.recipes.length,10);v.makeRequest=!1,k({type:b,data:c,num:a.recipes.length,recipes:a.recipes,allRecipesNum:d},f),setTimeout(function(){m(window.History.getState())},0)}var j=v.recipesPerPage,l=a("#filter_recipes").data("all-url")||"/php/all_recipes_result.php";d&&(j=d),a.ajax({url:l,dataType:"json",data:"num="+j+"&type="+b+"&data="+c,beforeSend:g,success:h,error:function(a,b,c){window.console&&(console.log(a),console.log(b),console.log(c))}})}function h(b,c){function d(){i()}function e(a){var b=parseInt(a.id.length,10)+parseInt(a.recipes.length,10);v.makeRequest=!1,k({num:a.recipes.length,recipes:a.recipes,allRecipesNum:b},c),setTimeout(function(){m(window.History.getState())},0)}var f=v.recipesPerPage,g=a("#filter_recipes").data("last-url")||"/php/last_recipes_result.php";b&&(f=b),a.ajax({url:g,dataType:"json",data:"num="+f,beforeSend:d,success:e})}function i(){a("#recipe_feed_block").empty().html('<div class="preloader"><img src="/images/preloader.gif" width="281" height="52" alt="" /></div>')}function j(){function b(b){var c=window.History;if(c.enabled){v.makeRequest=!1;var d=c.getState();d.data.num=a("#recipe_feed_block .b-recipe-thumb").length,d.data.recipes&&b.recipes&&(d.data.recipes=d.data.recipes.concat(b.recipes)),k(d.data,!1)}}for(var c=[],d=a("#get_more_recipes").data("more-url")||"/php/get_more_recipes.php",f=0;f<v.recipesPerPage;f++)e[0]&&(c[f]=e.shift());return a.ajax({url:d,dataType:"json",data:"id="+c,beforeSend:function(){a("#get_more_recipes").addClass("preload")},success:function(c){a("#get_more_recipes").removeClass("preload");for(var d,e=a('<div class="block" style="display:none;"></div>'),f="",g=0;g<Math.ceil(c.recipes.length/3);g++){f+='<div class="row">';for(var h=0;3>h&&(d=3*g+h,!(d>=c.recipes.length));h++)f+='<div class="col-sm-4"><div class="b-recipe-thumb"><a href="'+c.recipes[d].href+'" style="background-image: url('+c.recipes[d].src+');" class="b-recipe-thumb__photo"><img src="data:image/gif;base64,R0lGODlhBgAEAIAAAP///wAAACH5BAEAAAAALAAAAAAGAAQAAAIEhI+pVwA7"></a><hr class="i-size-S"><a href="'+c.recipes[d].href+'" class="col-sm-10 center-block"><b>'+c.recipes[d].name+'</b></a><hr class="i-size-S"><div class="b-recipe-thumb__author author">От: '+c.recipes[d].author+'</div><div class="b-recipe-thumb__info"><span class="comments_icon" title="Оставить отзыв"><noindex><a href="'+c.recipes[d].href+'#comments">'+c.recipes[d].comments+"</a></noindex></span></div></div></div>",2!==h&&d<c.recipes.length-1&&(f+='<hr class="visible-xs-block">');f+='</div><hr class="i-size-L hidden-xs"><hr class="visible-xs-block">'}e.html(f),a("#recipe_feed_block").append(e).find(".block:last .photo a").each(function(){var b=a(this),c=b.children("img"),d=new Image;d.src=c.attr("src");var e=Math.floor(d.height*c.attr("width")/d.width);e>0?c.css({marginTop:parseInt(b.css("height"))/2-e/2+"px"}):c.load(function(){var a=Math.floor(d.height*c.attr("width")/d.width);a>0&&c.css({marginTop:parseInt(b.css("height"))/2-a/2+"px"})})}).end().find("div.block:last").css({opacity:0}).show().animate({opacity:1},500),a.scrollTo(a("#recipe_feed_block .block:last .col-sm-4:first"),1e3),b(c),n()}}),!1}function k(a,b){function c(){var b=[];return a.type&&a.data&&b.push(a.type+"="+a.data),b.push("num="+a.num),b=b.join("&"),""!=b&&(b="?"+b),b}var d=window.History;if(d.enabled){var e=c();return b?void d.replaceState(a,"Рецепты",e):void d.pushState(a,"Рецепты",e)}}function l(){var a=window.History;a.enabled&&a.Adapter.bind(window,"statechange",function(){if(v.makeRequest){var b=a.getState();b.data.recipes?m(b):g(null,null)}v.makeRequest=!0})}function m(b){if(b.data.type&&b.data.data){var c=p(b.data.type),d=q(c,b.data.data);s(a("."+b.data.type+" a"),d)}else s(a(),"");r(b.data.recipes),u(b.data.allRecipesNum),o(),n()}function n(){var b=window.History;if(b.enabled)var c=b.getState(),d=c.data.allRecipesNum-c.data.recipes.length;else var d=e.length;0==d?a("#get_more_recipes").hide():a("#get_more_recipes").show()}function o(){a("#topbar div.item").each(function(){"Рецепты"==a(this).text()&&a(this).html(window.search&&""!=window.search?'<a href="'+window.pathname+'"><span>Рецепты</span></a>':"<span><span>Рецепты</span></span>")})}function p(a){switch(a){case"cuisine":return cuisineArray;case"dish":return dishTypeArray;case"ingredient":return mainIngredientArray;case"tag":return tagArray}}function q(a,b){for(var c=0;c<a[0].length;c++)if(a[0][c]==b)return a[1][c]}function r(b){for(var c,d="",e=0;e<Math.ceil(b.length/3);e++){d+='<div class="row">';for(var f=0;3>f&&(c=3*e+f,!(c>=b.length));f++)d+='<div class="col-sm-4"><div class="b-recipe-thumb"><a href="'+b[c].href+'" style="background-image: url('+b[c].src+');" class="b-recipe-thumb__photo"><img src="data:image/gif;base64,R0lGODlhBgAEAIAAAP///wAAACH5BAEAAAAALAAAAAAGAAQAAAIEhI+pVwA7"></a><hr class="i-size-S"><a href="'+b[c].href+'" class="col-sm-10 center-block"><b>'+b[c].name+'</b></a><hr class="i-size-S"><div class="b-recipe-thumb__author author">От: '+b[c].author+'</div><div class="b-recipe-thumb__info"><span class="comments_icon" title="Оставить отзыв"><noindex><a href="'+b[c].href+'#comments">'+b[c].comments+"</a></noindex></span></div></div></div>",2!==f&&c<b.length-1&&(d+='<hr class="visible-xs-block">');d+='</div><hr class="i-size-L hidden-xs"><hr class="visible-xs-block">'}a("#recipe_feed_block").html(d)}function s(b,c){a("#filter_recipes a.active").removeClass("active").find("span.bg span").text("Выберите"),b.removeClass("open").addClass("active").find("span.bg span").text(c)}function t(){var b=[];return a("#recipe_feed_block .b-recipe-thumb").each(function(){var c=a(this);b.push({name:c.find("b").text(),href:c.find("a:first").attr("href"),src:/url\(['"]?([^'"]*)['"]?\)/.exec(c.find("a:first").css("backgroundImage"))[1],author:c.find(".author").text().substring(4),comments:c.find(".comments_icon a").text()})}),b}function u(b){function c(a){return/(10|11|12|13|14|15|16|17|18|19)$/.test(a)?"рецептов":/.*1$/.test(a)?"рецепт":/[2-4]$/.test(a)?"рецепта":"рецептов"}a("#fc_statistics").find("span.num").text(b).end().find("span.word").text(c(b))}var v=this;v.recipesPerPage=6,v.makeRequest=!0,b()}function d(){function b(){c(),d()}function c(){g.$statistics=a("#fc_statistics"),g.$getMoreButton=a("#get_more_recipes"),g.recipesPerPage=27}function d(){g.$getMoreButton.click(f)}function f(){for(var b=[],c=a("#filter_recipes").data("all-url")||"/php/all_recipes_result.php",d=0;d<g.recipesPerPage;d++)e[0]&&(b[d]=e.shift());return a.ajax({url:c,dataType:"json",data:"id="+b,beforeSend:function(){a("#get_more_recipes").addClass("preload")},success:function(b){function c(){var b=e.length;0==b?a("#get_more_recipes").hide():a("#get_more_recipes").show()}a("#get_more_recipes").removeClass("preload");for(var d,f=a('<div class="block" style="display:none;"></div>'),g="",h=0;h<Math.ceil(b.recipes.length/3);h++){g+='<div class="row">';for(var i=0;3>i&&(d=3*h+i,!(d>=b.recipes.length));i++)g+='<div class="col-sm-4"><div class="b-recipe-thumb"><a href="'+b.recipes[d].href+'" style="background-image: url('+b.recipes[d].src+');" class="b-recipe-thumb__photo"><img src="data:image/gif;base64,R0lGODlhBgAEAIAAAP///wAAACH5BAEAAAAALAAAAAAGAAQAAAIEhI+pVwA7"></a><hr class="i-size-S"><a href="'+b.recipes[d].href+'" class="col-sm-10 center-block"><b>'+b.recipes[d].name+'</b></a><hr class="i-size-S"><div class="b-recipe-thumb__author author">От: '+b.recipes[d].author+'</div><div class="b-recipe-thumb__info"><span class="comments_icon" title="Оставить отзыв"><noindex><a href="'+b.recipes[d].href+'#comments">'+b.recipes[d].comments+"</a></noindex></span></div></div></div>",2!==i&&d<b.recipes.length-1&&(g+='<hr class="visible-xs-block">');g+='</div><hr class="i-size-L hidden-xs"><hr class="visible-xs-block">'}f.html(g),a("#recipe_feed_block").append(f).find("div.block:last").css({opacity:0}).show().animate({opacity:1},500),a.scrollTo(a("#recipe_feed_block div.block:last div.b-recipe-thumb:first"),1e3),c()}}),!1}var g=this;b()}a(document).bind("click",function(){a("#filter_list:visible").slideUp("fast",function(){a("#filter_recipes .open").removeClass("open")})});var e=window.allRecipesResult||[];a(function(){new b,new c,new d})})}(jQuery);