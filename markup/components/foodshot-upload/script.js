!function(a){"use strict";a(function(){function b(){var b=a(this);if(a("#foodshotURL").val()!==o&&(o=a("#foodshotURL").val(),""!==a("#foodshotURL").val())){if(!/^http/.exec(a("#foodshotURL").val()))return;if(!/jpg|jpeg|png|webp/.exec(c(a("#foodshotURL").val())))return;a.ajax({url:b.data("url"),type:b.data("method"),dataType:"json",data:"url="+b.val(),success:function(a){a&&"Y"===a.STATUS&&(d(a.URL),b.val(a.URL))},error:function(a,b,c){window.console&&(console.log(a),console.log(b),console.log(c))}})}}function c(a){return a=a.split("?")[0],a.slice((a.lastIndexOf(".")-1>>>0)+2)}function d(b){l(""),a(".b-foodshot-upload__block-body").fadeOut(),a("#foodshotPreview").css({backgroundImage:"url( "+b+")"}).fadeIn(),a(".b-foodshot-upload__remove-image").show()}function e(){a(".b-foodshot-upload__block-body").fadeIn(),a("#foodshotPreview").fadeOut(500,function(){a("#foodshotPreview, .b-foodshot-upload__remove-image").hide()}),a("#foodshotURL").val("").parent().find("label").removeClass("active"),a("#foodshotFileBase64, #foodshotFileName, #foodshotFileElem").val("")}function f(a){a.preventDefault(),a.stopPropagation()}function g(){a(".b-foodshot-upload__block").addClass("i-highlight")}function h(){a(".b-foodshot-upload__block").removeClass("i-highlight")}function i(a){var b=a.dataTransfer,c=b.files;j(c)}function j(a){var b=Array.from(a);b.forEach(k)}function k(a){return a.size>15e6?void l("Размер файла больше 15 Mб."):/jpg|jpeg|png|webp/.exec(c(a.name))?void m(a):void l("Загрузите изображение JPG, PNG, WEBP.")}function l(b){a(".b-foodshot-upload__error").text(b)}function m(a){var b=new FileReader;b.readAsDataURL(a),b.onloadend=function(){d(b.result),n(a,b.result)}}function n(b,c){a("#foodshotFileName").val(b.name),a("#foodshotFileBase64").val(c)}a(".chips-placeholder").chips({placeholder:"Введите тэг + Enter",secondaryPlaceholder:"+Тэг",onChipAdd:function(b,c){var d=String(a(c).text()).split("close")[0];a(b).append('<input type="hidden" name="tag[]" value="'+d+'">')},onChipDelete:function(b,c){var d=String(a(c).text()).split("close")[0];a('input[value="'+d+'"]').remove()}}),a("#foodshotURL").keyup(b).click(b).blur(b);var o="",p=document.getElementById("foodshotDropArea");["dragenter","dragover","dragleave","drop"].forEach(function(a){p.addEventListener(a,f,!1)}),["dragenter","dragover"].forEach(function(a){p.addEventListener(a,g,!1)}),["dragleave","drop"].forEach(function(a){p.addEventListener(a,h,!1)}),p.addEventListener("drop",i,!1),a("#foodshotFileElem").change(function(){var a=this.files;if(a.size>15e6)return void l("Размер файла больше 15 Mб.");if(!/jpg|jpeg|png|webp/.exec(c(a[0].name)))return void l("Загрузите изображение JPG, PNG, WEBP.");var b=new FileReader;b.readAsDataURL(a[0]),b.onloadend=function(){d(b.result)}}),a(".b-foodshot-upload__remove-image").click(function(a){a.preventDefault(),e()}),a(".b-foodshot-upload__buttons span").click(function(b){b.preventDefault(),a(".b-foodshot-upload__text .input-field input, .b-foodshot-upload__text .input-field textarea").val(""),e(),a(".b-foodshot-upload__buttons button").removeClass("i-disabled")}),a(".b-foodshot-upload form").submit(function(){a(".b-foodshot-upload__buttons button").addClass("i-disabled")})})}(jQuery);