!function(a){function b(a){a.on("action:like",function(b,c){a.find(".b-recipe-menu__i .b-like-button__num").text(c)}).on("action:cooked",function(b,c){a.find(".b-recipe-menu__i .b-cooked-button__num").text(c)}),a.find(".b-print-button").click(function(){return i(),!1}),a.find(".b-info-block__icon.i-cooked").click(c),a.find(".b-info-block__icon.i-like").click(d)}function c(a){var b="cooked";e(a,b)}function d(a){var b="like";e(a,b)}function e(b,c){var d=a(b.target),e=d.data("href"),g="POST";return e?(b.preventDefault(),void a.ajax({url:e,type:g,dataType:"json",success:function(a){"Y"===a.success&&f(d,a,c)},error:ajaxError})):!0}function f(b,c,d){var e,f,i,j;j=b.data("href"),-1!==j.search("dislike")?j=j.replace("dislike","like"):-1!==j.search("like")?j=j.replace("like","dislike"):-1!==j.search("uncooked")?j=j.replace("uncooked","cooked"):-1!==j.search("cooked")&&(j=j.replace("cooked","uncooked")),b.data("href",j),c.total=c.total||(c.users?c.users.length:0),a(".b-recipe-menu").trigger("action:"+d,[c.total]),b.toggleClass("i-active"),e=b.hasClass("i-active"),f=b.siblings(".b-info-block__text"),f.length||(g(b),f=b.siblings(".b-info-block__text")),i=h(c.users),i||f.after('<div class="b-info-block__title"><b>'+f.find("b").text()+"</b></div>").remove(),f.find(".b-info-block__users").html(i),f.find(".b-info-block__others").text(c.others||"")}function g(a){var b=a.siblings(".b-info-block__title").remove();a.after('<div class="b-info-block__text">'+b.html()+'<div class="b-info-block__users"></div><div class="b-info-block__others"></div></div>')}function h(a){var b="";return a instanceof Array?(a.forEach(function(a){b+='<a href="'+a.href+'" title="'+a.name+'" class="b-info-block__user"><img src="'+a.src+'" width="20" height="20" alt=""></a> '}),b):b}function i(){function b(b){var c=a("<div></div>").html(b),d=c.find("img"),e=c.find(".screen"),f=e.children("div"),g=parseInt(f.css("width")),h=parseInt(f.css("height")),i=200/g;return f.css({width:g*i+"px",height:h*i+"px"}),d.attr({width:g*i,height:h*i}),c.html()}function c(){var c={browser:a.browser,title:a("title").text(),h1:a("h1").text(),recipeInfo:d.find(".recipe_info").html(),needed:e.find(".needed").find("table").html(),titleImage:b(e.find(".image").html()),description:d.find(".description").html(),stages:g},f=document.getElementById("print-recipe").innerHTML,h=tmpl(f);return h(c)}var d=a(".recipe"),e=d.find(".title"),f=d.find(".instructions"),g=[];f.find(".stage").each(function(){var c=a("<div></div>").html(a(this).html());c.find(".body").append('<div class="i-clearfix"></div>');var d=c.find(".image");d.html(b(d.html())),g.push(c.html())});var h=window.open("","","width=800, height=800,toolbar=0,scrollbars=yes,status=0,directories=0,location=0,menubar=0,resizable=0");h.document.write(c())}a(function(){a(".b-recipe-menu").each(function(c,d){var e=a(d);e.hasClass("i-ready")||(e.addClass("i-ready"),b(e))}),window.BX&&BX.addCustomEvent("onFrameDataReceived",function(){a(".b-recipe-menu").each(function(c,d){var e=a(d);e.hasClass("i-ready")||(e.addClass("i-ready"),b(e))})})})}(jQuery);